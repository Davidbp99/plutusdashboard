<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gift Cards Viewer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body {
      background-color: #121212;
      color: #f1f1f1;
      padding-top: 40px;
    }
    .card,
    .form-control,
    .form-select {
      background-color: #1a1a1a;
      color: #f1f1f1;
      border-color: #333;
    }
    .badge.bg-info {
      background-color: #0dcaf0 !important;
      color: #000;
    }
  </style>
</head>
<body>
<div class="container">
  <h2 class="mb-4">Gift Cards Viewer</h2>

  <div class="row mb-3">
    <div class="col-md-3">
      <label class="form-label">Filter by Country</label>
      <select id="countryFilter" class="form-select">
        <option value="">All Countries</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Min Amount</label>
      <select id="amountFilter" class="form-select">
        <option value="1-99999999">Any</option>
        <option value="50-100">50–100</option>
        <option value="100-200">100–200</option>
        <option value="200-500">200–500</option>
        <option value="500-999999">500+</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Search Gift Cards</label>
      <input type="text" id="searchFilter" class="form-control" placeholder="e.g. amazon, lidl, travel..." oninput="applyFilters()">
    </div>
    <div class="col-md-3">
      <label class="form-label">Filter by Category</label>
      <select id="categoryDropdown" class="form-select" multiple onchange="applyFilters()"></select>
    </div>
  </div>

  <div class="row" id="giftcardContainer"></div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    fetch('https://davidbp99.github.io/plutusdashboard/giftcardsonly/gc.csv')
      .then(res => res.text())
      .then(csvText => {
        const parsed = Papa.parse(csvText, {
          header: true,
          skipEmptyLines: true
        });

        allGiftCards = parsed.data.map(obj => ({
          name: obj.name,
          countries: (obj.countries || '').split(';').map(s => s.trim()),
          categories: (obj.categories || '').split(';').map(s => s.trim()),
          currency_code: obj.currency,
          denominations: (obj.denominations || '').split(';').map(n => parseFloat(n.trim())).filter(n => !isNaN(n)),
          discount_percentage: obj.discount,
          expiry: obj.expiry,
          gift_card_url: obj.url
        }));

        populateFilters(allGiftCards);
        renderGiftCards(allGiftCards);
      })
      .catch(err => {
        console.error('❌ Failed to load or parse CSV:', err);
        document.getElementById('giftcardContainer').innerHTML = '<p class="text-danger">Failed to load gift cards.</p>';
      });
  });
</script>
<script src="app.js"></script>
</body>
</html>
